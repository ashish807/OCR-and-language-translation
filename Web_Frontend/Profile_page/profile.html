<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>Profile Page</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="card-container">
    	<img class="round" id="myimg" alt="user">
        <img src="camera.svg" id="upfile1" style="color:blue"/>
        <div id="profileSection">
    	  <h3 id="userPfFullName"></h3>
    	  <h6 id="userplace"></h6>
    	  <p  id="usercollege"></p>
    	  <div class="buttons">
    	    <button class="primary" id="upload" onclick="showEditProfileForm()">Edit Profile</button>
    	  </div>
        </div>
        <div id="editProfileForm">
            <div class="form-group">
            <label for="userFullName">Name<span class="text-danger ml-1">*</span></label>
            <input type="text" class="form-control" id="userFullName" onblur="checkUserFullName()" placeholder="Fullname">
            </div>
            <div class="form-group">
            <label for="userplc">Enter Place<span class="text-danger ml-1">*</span></label>
            <input type="text" class="form-control" id="userplc" placeholder="Fullname">
            </div>
            <div class="form-group">
            <label for="userclg">Enter College Name<span class="text-danger ml-1">*</span></label>
            <input type="text" class="form-control" id="userclg" placeholder="Fullname">
            </div>
       <button type="button" class="btn btn-outline-primary btn-block text-uppercase mb-3" onclick="saveProfile()">Update</button>
       <button type="button" class="btn btn-outline-secondary btn-block text-uppercase" onclick="hideEditProfileForm()">Cancel</button>
       </div>       	
    </div>
    <header>
    <div class="nav-icon float-right" onclick="nextpage()">
        <span></span>
        <span></span>
        <span></span>
    </div>
    </header>
    <script>
        function nextpage(){
        window.location.replace("D:/Web_Testing/My_Way/Navigation_and_Homepage/Nav.html");
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.2/firebase-storage.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script id="Mainscript">
    var imgname,imgurl;
    var files=[];
    var reader;

    var firebaseConfig = {
    apiKey: "AIzaSyBQGzQWSYg6r6gvoFThzJsvrMiHE2v4ONY",
    authDomain: "ocr-languagetranslation.firebaseapp.com",
    projectId: "ocr-languagetranslation",
    storageBucket: "ocr-languagetranslation.appspot.com",
    messagingSenderId: "968531366311",
    appId: "1:968531366311:web:400afa9cb9d548860e6682"
    };
  // Initialize Firebase
   firebase.initializeApp(firebaseConfig);

   document.getElementById("upfile1").onclick=function(e){
   	var input=document.createElement('input');
   	input.type='file';
   	input.onchange = e =>{
   		files=e.target.files;
   		reader=new FileReader();
   		reader.onload=function(){
   			document.getElementById("myimg").src=reader.result;
   		 }
   			reader.readAsDataURL(files[0]);
   		}
   		input.click();
   	}
   	document.getElementById('upload').onclick=function(){
   		imgname=document.getElementById('fullname').innerHTML;
   		var uploadtask=firebase.storage().ref('Images/'+imgname+".png").put(files[0]);
   		uploadtask.on('state_changed',function(snapshot){
               var progress=(snapshot.bytesTransferred/snapshot.totalBytes)*100;
               console.log("upload"+progress+"done");
   		    },

   			function(error){
   		    	alert('error in saving the image');
   		    },
   			function(){
   				uploadtask.snapshot.ref.getDownloadURL().then(function(downloadURL){
   					imgurl=downloadURL;
   				firebase.database().ref('Pictures/'+imgname).set({
   					Name:imgname,
                    Link:imgurl
   				});
   				alert('image added successfully')
               }
            );   		
   		});
   	}

   	firebase.auth().onAuthStateChanged((user)=>{
    if (user) {
    //   User is signed in.
        let user = firebase.auth().currentUser;
        let uid
        if(user != null){
            uid = user.uid;
        }
        let firebaseRefKey = firebase.database().ref().child(uid);
        firebaseRefKey.on('value', (dataSnapShot)=>{
            document.getElementById("userPfFullName").innerHTML = dataSnapShot.val().userFullName;
            document.getElementById("userplace").innerHTML = dataSnapShot.val().userplace;
             userEmail = dataSnapShot.val().userEmail;
             alert(userEmail);
            // userPassword = dataSnapShot.val().userPassword;
            document.getElementById("usercollege").innerHTML = dataSnapShot.val().usercollege;
        })
    } else {
    //   No user is signed in.
    }
});
// xxxxxxxxxx Show edit profile form with detail xxxxxxxxxx
function showEditProfileForm(){
    document.getElementById("profileSection").style.display = "none"
    document.getElementById("editProfileForm").style.display = "block"
    var userPfFullName = document.getElementById("userPfFullName").innerHTML;
    var userplace = document.getElementById("userplace").innerHTML;
    var usercollege = document.getElementById("usercollege").innerHTML;
    document.getElementById("userFullName").value = userPfFullName; 
    document.getElementById("userplc").value = userplace; 
    document.getElementById("userclg").value = usercollege; 
}
// xxxxxxxxxx Hide edit profile form xxxxxxxxxx
function hideEditProfileForm(){
    document.getElementById("profileSection").style.display = "block";
    document.getElementById("editProfileForm").style.display = "none";
}
// xxxxxxxxxx Save profile and update database xxxxxxxxxx
function saveProfile(){
    let userFullName = document.getElementById("userFullName").value 
    let userplace = document.getElementById("userplc").value 
    let userclg = document.getElementById("userclg").value
    var userFullNameFormate = /^([A-Za-z.\s_-])/; 
    var checkUserFullNameValid = userFullName.match(userFullNameFormate);
    if(checkUserFullNameValid == null){
        return checkUserFullName();
    }else{
        let user = firebase.auth().currentUser;
        let uid;
        if(user != null){
            uid = user.uid;
        }
        var firebaseRef = firebase.database().ref();
        var userData = {
            userFullName: userFullName,
            userplace: userplace,
            usercollege: userclg,
        }
        firebaseRef.child(uid).set(userData);
        swal({
            type: 'successfull',
            title: 'Update successfull',
            text: 'Profile updated.', 
        }).then((value) => {
            setTimeout(function(){
                document.getElementById("profileSection").style.display = "block";
                document.getElementById("editProfileForm").style.display = "none";
            }, 1000)
        });
    }
}
</script>
</body>
</html>